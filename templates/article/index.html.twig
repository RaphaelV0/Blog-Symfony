{% extends 'base.html.twig' %}

{% block title %}Liste des articles{% endblock %}

{% block body %}
    <h1>Liste des articles</h1>

    <!-- Vérifier si l'utilisateur est administrateur -->
    {% if is_granted('ROLE_ADMIN') %}
        <!-- Lien pour ajouter un nouvel article -->
        <a href="{{ path('article_add') }}" class="btn btn-primary mb-3">Ajouter un article</a>
    {% endif %}

    <!-- Liste des articles -->
    <ul>
        {% for article in articles %}
            <li class="article-item">
                <!-- Afficher l'image de l'article s'il y en a une -->
                {% if article.image %}
                    <img src="{{ asset('uploads/images/' ~ article.image) }}" alt="{{ article.titre }}" class="article-image" />
                {% else %}
                    <img src="{{ asset('images/default-article.jpg') }}" alt="Image par défaut" class="article-image" />
                {% endif %}

                <!-- Titre cliquable -->
                <a href="{{ path('article_show', {'id': article.id}) }}">
                    <h2>{{ article.titre }}</h2>
                </a>

                <p><strong>Publié le : </strong>{{ article.datePublication|date('d/m/Y') }}</p>

                <p class="article-body">{{ article.corps[:150] ~ '...' }}</p>

                <!-- Liens pour modifier et supprimer (accessible uniquement pour l'admin) -->
                {% if is_granted('ROLE_ADMIN') %}
                    <a href="{{ path('article_edit', {'id': article.id}) }}" class="btn btn-secondary">Modifier</a>
                    <a href="{{ path('article_delete', {'id': article.id}) }}" 
                       class="btn btn-danger" 
                       onclick="return confirm('Voulez-vous vraiment supprimer cet article ?');">Supprimer</a>
                {% endif %}
            </li>
        {% else %}
            <li>Aucun article disponible pour le moment.</li>
        {% endfor %}
    </ul>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .article-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .article-image {
            max-width: 200px;
            height: auto;
            margin-bottom: 15px;
        }

        .article-item a {
            text-decoration: none;
            color: #007bff;
        }

        .article-item a:hover {
            text-decoration: underline;
        }

        .article-item h2 {
            font-size: 1.5em;
            margin: 0;
        }

        .article-item p {
            margin: 10px 0;
        }

        .btn {
            margin-top: 10px;
            margin-right: 5px;
        }

        .article-body {
            text-align: justify;
            margin-bottom: 10px;
        }
    </style>
{% endblock %}
